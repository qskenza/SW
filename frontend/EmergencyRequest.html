<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareConnect - Emergency Request</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .main-header {
            background: white;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            padding: 1rem 0;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #2e7d32;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: #388e3c;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #1b5e20;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #4caf50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Emergency Header */
        .emergency-header {
            background: #d32f2f;
            color: white;
            padding: 2.5rem;
            text-align: center;
        }

        .emergency-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .emergency-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Content */
        .content {
            padding: 2.5rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2.5rem;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            color: #2e7d32;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 3px solid #4caf50;
            font-weight: 600;
        }

        /* Emergency Hub */
        .emergency-hub {
            background: #ffebee;
            border-radius: 15px;
            padding: 2rem;
            border: 2px solid #d32f2f;
        }

        .critical-actions {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            margin: 2rem 0;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .call-emergency {
            background: #d32f2f;
            color: white;
        }

        .send-location {
            background: #388e3c;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        /* Emergency Contacts */
        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .contact-card {
            background: #f8fff8;
            border-radius: 12px;
            padding: 1.8rem;
            border-left: 5px solid #4caf50;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .contact-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.2rem;
        }

        .contact-avatar {
            width: 60px;
            height: 60px;
            background: #4caf50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            margin-right: 1.5rem;
        }

        .contact-details h3 {
            color: #2e7d32;
            font-size: 1.3rem;
            margin-bottom: 0.3rem;
        }

        .contact-details p {
            color: #666;
            font-size: 1rem;
        }

        .contact-actions {
            display: flex;
            gap: 1rem;
        }

        .contact-btn {
            flex: 1;
            padding: 0.9rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .call-contact {
            background: #4caf50;
            color: white;
        }

        .message-contact {
            background: #e8f5e8;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        .contact-btn:hover {
            transform: translateY(-2px);
        }

        /* Important Information */
        .info-box {
            background: #e8f5e8;
            border-radius: 12px;
            padding: 2rem;
            border-left: 5px solid #388e3c;
            grid-column: span 2;
        }

        .info-title {
            color: #2e7d32;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .info-text {
            color: #555;
            line-height: 1.7;
            font-size: 1.05rem;
        }

        /* Emergency Footer */
        .emergency-footer {
            background: #2e7d32;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 2rem;
            border-radius: 0 0 20px 20px;
        }

        .emergency-hotline {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .emergency-hotline i {
            color: #ff5252;
            margin-right: 10px;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .info-box {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .emergency-title {
                font-size: 2rem;
            }
            
            .contact-header {
                flex-direction: column;
                text-align: center;
            }
            
            .contact-avatar {
                margin-right: 0;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>

<script>
const API_URL = 'http://localhost:8000';
// Le code du widget est dans ChatbotWidget.html
</script>


<!-- CHATBOT - Add before </body> in ALL pages -->
<style>
    #chatbot-widget{position:fixed;bottom:20px;right:20px;z-index:1000;font-family:'Segoe UI',Arial,sans-serif}#chat-button{width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#2e7d32 0%,#4caf50 100%);border:none;cursor:pointer;box-shadow:0 4px 20px rgba(46,125,50,0.4);display:flex;align-items:center;justify-content:center;transition:all .3s ease}#chat-button:hover{transform:scale(1.1)}#chat-button svg{width:30px;height:30px;fill:white}#chat-window{display:none;position:fixed;bottom:90px;right:20px;width:380px;height:550px;background:white;border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,0.2);flex-direction:column;overflow:hidden}#chat-window.open{display:flex}.chat-header{background:linear-gradient(135deg,#2e7d32 0%,#4caf50 100%);color:white;padding:20px;display:flex;justify-content:space-between;align-items:center}.chat-header h3{margin:0;font-size:1.3rem}.chat-header p{margin:5px 0 0 0;opacity:0.9;font-size:0.9rem}#close-chat{background:none;border:none;color:white;font-size:1.5rem;cursor:pointer}#chat-messages{flex:1;overflow-y:auto;padding:20px;background:#f8fff8}.message{margin-bottom:15px;display:flex;flex-direction:column}.message.user{align-items:flex-end}.message.bot{align-items:flex-start}.message-content{max-width:80%;padding:12px 16px;border-radius:12px;word-wrap:break-word}.message.user .message-content{background:#2e7d32;color:white}.message.bot .message-content{background:white;color:#333;border:1px solid #e8f5e8}.message-time{font-size:0.75rem;color:#999;margin-top:5px}.chat-input-container{padding:15px;background:white;border-top:1px solid #e8f5e8;display:flex;gap:10px}#chat-input{flex:1;padding:12px 15px;border:2px solid #e8f5e8;border-radius:25px;font-size:0.95rem;outline:none}#chat-input:focus{border-color:#4caf50}#send-button{background:#4caf50;color:white;border:none;width:45px;height:45px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center}#send-button:hover{background:#388e3c}.quick-actions{padding:10px 20px;background:white;border-top:1px solid #e8f5e8;display:flex;gap:8px;flex-wrap:wrap}.quick-action-btn{padding:8px 12px;background:#e8f5e8;color:#2e7d32;border:none;border-radius:15px;font-size:0.85rem;cursor:pointer}.quick-action-btn:hover{background:#4caf50;color:white}
</style>

<div id="chatbot-widget">
    <button id="chat-button"><svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg></button>
    <div id="chat-window">
        <div class="chat-header"><div><h3>CareConnect Assistant</h3><p>Ask me anything</p></div><button id="close-chat">√ó</button></div>
        <div class="quick-actions">
            <button class="quick-action-btn" data-msg="Book an appointment">üìÖ Appointment</button>
            <button class="quick-action-btn" data-msg="I need emergency help">üö® Emergency</button>
        </div>
        <div id="chat-messages">
            <div class="message bot"><div class="message-content">Hello! How can I help you today?</div></div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="chat-input" placeholder="Type your message..." />
            <button id="send-button"><svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
        </div>
    </div>
</div>

<script>
let conversationId=null,userContext=null;const chatButton=document.getElementById('chat-button'),chatWindow=document.getElementById('chat-window'),closeChat=document.getElementById('close-chat'),chatMessages=document.getElementById('chat-messages'),chatInput=document.getElementById('chat-input'),sendButton=document.getElementById('send-button');chatButton.addEventListener('click',()=>{chatWindow.classList.toggle('open');chatWindow.classList.contains('open')&&chatInput.focus()});closeChat.addEventListener('click',()=>chatWindow.classList.remove('open'));async function sendMessage(msg){if(!msg.trim())return;addMessage(msg,'user');chatInput.value='';sendButton.disabled=true;showTypingIndicator();try{const res=await fetch(`${API_URL}/chat/`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg,conversation_id:conversationId,user_context:userContext})});const data=await res.json();hideTypingIndicator();conversationId=data.conversation_id;addMessage(data.reply,'bot')}catch(e){hideTypingIndicator();addMessage('Sorry, error occurred.',  'bot');console.error(e)}finally{sendButton.disabled=false}}function addMessage(text,type){const msgDiv=document.createElement('div');msgDiv.className=`message ${type}`;const contentDiv=document.createElement('div');contentDiv.className='message-content';contentDiv.textContent=text;const timeDiv=document.createElement('div');timeDiv.className='message-time';timeDiv.textContent=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});msgDiv.appendChild(contentDiv);msgDiv.appendChild(timeDiv);chatMessages.appendChild(msgDiv);chatMessages.scrollTop=chatMessages.scrollHeight}function showTypingIndicator(){const indicator=document.createElement('div');indicator.className='message bot';indicator.id='typing-indicator';indicator.innerHTML='<div style="padding:12px;background:white;border:1px solid #e8f5e8;border-radius:12px"><span style="height:8px;width:8px;background:#4caf50;border-radius:50%;display:inline-block;margin-right:4px;animation:typing 1.4s infinite"></span><span style="height:8px;width:8px;background:#4caf50;border-radius:50%;display:inline-block;margin-right:4px;animation:typing 1.4s infinite 0.2s"></span><span style="height:8px;width:8px;background:#4caf50;border-radius:50%;display:inline-block;animation:typing 1.4s infinite 0.4s"></span></div>';chatMessages.appendChild(indicator);chatMessages.scrollTop=chatMessages.scrollHeight}function hideTypingIndicator(){const indicator=document.getElementById('typing-indicator');indicator&&indicator.remove()}sendButton.addEventListener('click',()=>sendMessage(chatInput.value));chatInput.addEventListener('keypress',e=>{e.key==='Enter'&&sendMessage(chatInput.value)});document.querySelectorAll('.quick-action-btn').forEach(btn=>btn.addEventListener('click',()=>sendMessage(btn.dataset.msg)));function loadUserContext(){const username=sessionStorage.getItem('username'),fullName=sessionStorage.getItem('fullName'),studentId=sessionStorage.getItem('studentId');username&&(userContext={name:fullName||username,student_id:studentId||'N/A'})}loadUserContext();const style=document.createElement('style');style.textContent='@keyframes typing{0%,60%,100%{opacity:0.3}30%{opacity:1}}';document.head.appendChild(style);
</script>

<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo">CareConnect</div>
            <nav>
                <ul class="nav-links">
                    <li><a href="medical-dashboard.html">Dashboard</a></li>
                    <li><a href="appointment-booking.html">Appointments</a></li>
                    <li><a href="student-profile.html">Student Profile</a></li>
                    <li><a href="#" style="color: #d32f2f; font-weight: 600;">Emergency</a></li>
                </ul>
            </nav>
            <div class="user-info">
                <div class="user-avatar">AM</div>
                <span>Alexandra Miller</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Emergency Header -->
        <div class="emergency-header">
            <h1 class="emergency-title">Emergency Request</h1>
            <p class="emergency-subtitle">Immediate Medical Assistance & Emergency Contacts</p>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Emergency Hub -->
                <div class="section">
                    <h2 class="section-title">Emergency Hub</h2>
                    <div class="emergency-hub">
                        <h3 style="color: #d32f2f; margin-bottom: 1.5rem; font-size: 1.3rem;">Critical Actions</h3>
                        <div class="critical-actions">
                            <button class="action-btn call-emergency">
                                <i>üö®</i> Call Emergency Services (911)
                            </button>
                            <button class="action-btn send-location">
                                <i>üìç</i> Send Current Location
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Important Information -->
                <div class="info-box">
                    <h3 class="info-title">Important Information</h3>
                    <p class="info-text">
                        In case of a medical emergency, remain calm and provide clear information to the emergency service operator. 
                        If possible, have your student ID and health insurance details ready. Our emergency response team is trained 
                        to handle critical situations with care and professionalism. Remember to state your location clearly and 
                        describe the nature of the emergency.
                    </p>
                </div>
            </div>

            <!-- Right Column -->
            <div class="right-column">
                <!-- Emergency Contacts -->
                <div class="section">
                    <h2 class="section-title">Emergency Contacts</h2>
                    <div class="contacts-list">
                        <div class="contact-card">
                            <div class="contact-header">
                                <div class="contact-avatar">ER</div>
                                <div class="contact-details">
                                    <h3>Dr. Elena Rodriguez</h3>
                                    <p>Campus Doctor</p>
                                </div>
                            </div>
                            <div class="contact-actions">
                                <button class="contact-btn call-contact">Call Dr. Rodriguez</button>
                                <button class="contact-btn message-contact">Message</button>
                            </div>
                        </div>

                        <div class="contact-card">
                            <div class="contact-header">
                                <div class="contact-avatar">DC</div>
                                <div class="contact-details">
                                    <h3>Prof. David Chen</h3>
                                    <p>Academic Advisor</p>
                                </div>
                            </div>
                            <div class="contact-actions">
                                <button class="contact-btn call-contact">Call Prof. Chen</button>
                                <button class="contact-btn message-contact">Message</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Footer -->
        <div class="emergency-footer">
            <div class="emergency-hotline">
                <i>üìû</i> 24/7 Emergency Hotline: 1-800-XXX-XXXX
            </div>
            <p>Available for immediate medical assistance and crisis support</p>
        </div>
    </div>

    <script>
        // Emergency Button Actions
        document.querySelector('.call-emergency').addEventListener('click', function() {
            const confirmCall = confirm('Are you sure you want to call Emergency Services (911)?\n\nThis will initiate an emergency call.');
            if (confirmCall) {
                alert('Calling Emergency Services (911)...\n\nPlease stay on the line and provide your:\n1. Location\n2. Nature of emergency\n3. Contact information');
            }
        });

        document.querySelector('.send-location').addEventListener('click', function() {
            alert('Your current location has been shared with:\n‚Ä¢ Emergency Services\n‚Ä¢ Campus Security\n‚Ä¢ Emergency Contacts\n\nLocation sharing active for 30 minutes.');
        });

        // Contact Button Actions
        document.querySelectorAll('.call-contact').forEach(btn => {
            btn.addEventListener('click', function() {
                const contactName = this.closest('.contact-card').querySelector('h3').textContent;
                alert(`Calling ${contactName}...\n\nPlease wait while we connect your call.`);
            });
        });

        document.querySelectorAll('.message-contact').forEach(btn => {
            btn.addEventListener('click', function() {
                const contactName = this.closest('.contact-card').querySelector('h3').textContent;
                alert(`Opening secure message interface for ${contactName}.\n\nYou can send your emergency message here.`);
            });
        });
    </script>
</body>
</html>